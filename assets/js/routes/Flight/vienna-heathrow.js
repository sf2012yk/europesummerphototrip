// Vienna Heathrow
const Vienna_LHR = [48.11851237806887, 16.566266743122807];
const Pt_VIELHR_1 = [48.1178637309487, 16.566163892395895];
const Pt_VIELHR_2 = [48.11709511568907, 16.565426267227373];
const Pt_VIELHR_3 = [48.11657903351261, 16.56703857656748];
const Pt_VIELHR_4 = [48.11448516117619, 16.565823822968618];
const Pt_VIELHR_5 = [48.113747861885756, 16.567966206612315];
const Pt_VIELHR_6 = [48.11296631304847, 16.570307368208532];
const Pt_VIELHR_7 = [48.11202254016458, 16.57260435685745];
const Pt_VIELHR_8 = [48.11119672467213, 16.575365160522008];
const Pt_VIELHR_9 = [48.10972202109746, 16.576027753455673];
const Pt_VIELHR_10 = [48.109117380417544, 16.57563019772797];//é›¢é™¸ãƒ»ç€é™¸
const Pt_VIELHR_11 = [48.1092943491578, 16.575055950565744];
const Pt_VIELHR_12 = [48.10958929570394, 16.573995801958553];
const Pt_VIELHR_13 = [48.1100464595224, 16.572825221161537];
const Pt_VIELHR_14 = [48.110518366293164, 16.570881615327515];
const Pt_VIELHR_15 = [48.11174235427191, 16.567480305152493];
const Pt_VIELHR_16 = [48.11375082623798, 16.561386626943623];
const Pt_VIELHR_17 = [48.116994863837135, 16.551293128642474];
const Pt_VIELHR_18 = [48.12152142855521, 16.53770997432757];//é›¢é™¸é–‹å§‹
const Pt_VIELHR_19 = [48.12435488200629, 16.52071404787799];
const Pt_VIELHR_20 = [48.12410236757579, 16.498777341946862];
const Pt_VIELHR_21 = [48.12017490978773, 16.460009700848172];
const Pt_VIELHR_22 = [48.118211068264564, 16.430487458832427];
const Pt_VIELHR_23 = [48.118982586358925, 16.41252196703292];
const Pt_VIELHR_24 = [48.125785471833645, 16.387097118401122];
const Pt_VIELHR_25 = [48.132938049762956, 16.359676104153042];
const Pt_VIELHR_26 = [48.14583821977523, 16.315130088650648];
const Pt_VIELHR_27 = [48.167189761503934, 16.240724028361203];
const Pt_VIELHR_28 = [48.18948157591929, 16.16658300914857];//Purkersdorf
const Pt_VIELHR_29 = [48.223742520256266, 16.122900725694162];
const Pt_VIELHR_30 = [48.27175200046681, 16.089754884356427];
const Pt_VIELHR_31 = [48.32934622135033, 16.049645927952355];//Tull Donau
const Pt_VIELHR_32 = [48.38326102969924, 15.978474240620052];//60
const Pt_VIELHR_33 = [48.439876266391565, 15.874583075913707];
const Pt_VIELHR_34 = [48.49344119372769, 15.761800757943714];
const Pt_VIELHR_35 = [48.54509554054929, 15.650235451729726];
const Pt_VIELHR_36 = [48.598484677714815, 15.537189431708823];//100
const Pt_VIELHR_37 = [48.650429289489246, 15.42540414779663];
const Pt_VIELHR_38 = [48.70342983227062, 15.311097390029628];
const Pt_VIELHR_39 = [48.755543457501396, 15.200993087448879];
const Pt_VIELHR_40 = [48.80787984738722, 15.087106575436549];       
const Pt_VIELHR_41 = [48.85933222570009, 14.972799819390048];//150 ãƒã‚§ã‚³å›½å¢ƒ
const Pt_VIELHR_42 = [48.91183655546178, 14.861014533773972];
const Pt_VIELHR_43 = [48.963458048944126, 14.74670777698774];
const Pt_VIELHR_44 = [49.01667987201721, 14.634922492917624];
const Pt_VIELHR_45 = [49.06819291024928, 14.523557453347136];
const Pt_VIELHR_46 = [49.12020268013432, 14.41009118693156];//200  
const Pt_VIELHR_47 = [49.17160845932369, 14.296624921155978];
const Pt_VIELHR_48 = [49.223235384066236, 14.184839637210537];
const Pt_VIELHR_49 = [49.27453424598733, 14.07263410812548];            
const Pt_VIELHR_50 = [49.32632760633977, 13.959588087298355];
const Pt_VIELHR_51 = [49.37861375207502, 13.845701575327583];
const Pt_VIELHR_52 = [49.42975106502773, 13.73433653559085];
const Pt_VIELHR_53 = [49.481927252699485, 13.621710759762037];
const Pt_VIELHR_54 = [49.53322968341654, 13.509505230078542];
const Pt_VIELHR_55 = [49.584205866400836, 13.39561871863972];
const Pt_VIELHR_56 = [49.63621752495032, 13.28257269789571];//300
const Pt_VIELHR_57 = [49.687901816953676, 13.169946921908972];
const Pt_VIELHR_58 = [49.73953121541262, 13.058581883726522];//320
const Pt_VIELHR_59 = [49.790834436583765, 12.946376352879403];
const Pt_VIELHR_60 = [49.84127032150035, 12.83248984099175];
const Pt_VIELHR_61 = [49.89300731237602, 12.721124801953202];//350
const Pt_VIELHR_62 = [49.943789211694025, 12.609092621078053];
const Pt_VIELHR_63 = [49.994605903171006, 12.494785863601955];
const Pt_VIELHR_64 = [50.04563882210859, 12.36745149811212];//cheb
const Pt_VIELHR_65 = [50.07747315949123, 12.249362532235079];
const Pt_VIELHR_66 = [50.10847782508694, 12.117825710935627];
const Pt_VIELHR_67 = [50.13811569206894, 11.982506683263276];
const Pt_VIELHR_68 = [50.166658457695405, 11.847607901237547];
const Pt_VIELHR_69 = [50.19679834240139, 11.713549606931073];
const Pt_VIELHR_70 = [50.225574935547066, 11.57949131593262];
const Pt_VIELHR_71 = [50.253796779864736, 11.445853269358983];
const Pt_VIELHR_72 = [50.2833446023785, 11.311794977379755];
const Pt_VIELHR_73 = [50.31180061458781, 11.176475947862219];
const Pt_VIELHR_74 = [50.34023960703115, 11.042837900208076];
const Pt_VIELHR_75 = [50.37000182185004, 10.905837888569494];
const Pt_VIELHR_76 = [50.40028112838173, 10.772620089728699];
const Pt_VIELHR_77 = [50.428399441209955, 10.638982042664678];
const Pt_VIELHR_78 = [50.456768621104125, 10.50240227842647];
const Pt_VIELHR_79 = [50.486190358236136, 10.369604722248427];
const Pt_VIELHR_80 = [50.51586100761657, 10.234705939250233];
const Pt_VIELHR_81 = [50.544177743968625, 10.101488137093098];
const Pt_VIELHR_82 = [50.573278175462136, 9.965328618002829];
const Pt_VIELHR_83 = [50.60156044708321, 9.830009589964767];
const Pt_VIELHR_84 = [50.63009230511847, 9.69721203346257];
const Pt_VIELHR_85 = [50.660471692786295, 9.561472759462045];
const Pt_VIELHR_86 = [50.68790284730096, 9.426573976098137];//600
const Pt_VIELHR_87 = [50.71663944699881, 9.292941342093847];
const Pt_VIELHR_88 = [50.74563329868692, 9.159723541981375];
const Pt_VIELHR_89 = [50.77457853957055, 9.02371799020684];
const Pt_VIELHR_90 = [50.80339726252905, 8.889432496824453];
const Pt_VIELHR_91 = [50.831082235884736, 8.75550038752026];//Marburg
const Pt_VIELHR_92 = [50.86053530380744, 8.62050812721857];
const Pt_VIELHR_93 = [50.888855176092825, 8.486576018165993];
const Pt_VIELHR_94 = [50.91838641178852, 8.349412231928284];
const Pt_VIELHR_95 = [50.94760174462436, 8.215690954934596];
const Pt_VIELHR_96 = [50.9745534567063, 8.08434694474951];
const Pt_VIELHR_97 = [51.003359516592596, 7.945871133186511];
const Pt_VIELHR_98 = [51.03177394282492, 7.812149856322121];
const Pt_VIELHR_99 = [51.06054448762518, 7.677834260836671];
const Pt_VIELHR_100 = [51.08965360502257, 7.543867598046255];
const Pt_VIELHR_101 = [51.11783406814459, 7.408875339498854];
const Pt_VIELHR_102 = [51.146219043861926, 7.2763567602660855];
const Pt_VIELHR_103 = [51.175251228543864, 7.141364501963308];//Solingen
const Pt_VIELHR_104 = [51.20315807837049, 7.00566547684606];
const Pt_VIELHR_105 = [51.23259697728072, 6.871733365494029];
const Pt_VIELHR_106 = [51.26024795645076, 6.736741108903608];//Dusseldorf
const Pt_VIELHR_107 = [51.28810332068625, 6.603162381608805];
const Pt_VIELHR_108 = [51.31152411996796, 6.464636293874531];
const Pt_VIELHR_109 = [51.332725098800246, 6.325756824137858];
const Pt_VIELHR_110 = [51.35347489608452, 6.185110438672];
const Pt_VIELHR_111 = [51.37399470655654, 6.045170819174917];
const Pt_VIELHR_112 = [51.39362333590979, 5.903110903511831];
const Pt_VIELHR_113 = [51.4145659550986, 5.762464520086823];
const Pt_VIELHR_114 = [51.43549898498374, 5.6211113672403705];
const Pt_VIELHR_115 = [51.45466082188475, 5.480111600827484];//Eindhoven
const Pt_VIELHR_116 = [51.47469505985644, 5.3394652152498];
const Pt_VIELHR_117 = [51.49511147109591, 5.199889949323035];
const Pt_VIELHR_118 = [51.5147211662555, 5.059191682651616];
const Pt_VIELHR_119 = [51.53546398396276, 4.920022745165588];
const Pt_VIELHR_120 = [51.55486613623293, 4.777489283941143];//Breda
const Pt_VIELHR_121 = [51.571598600673106, 4.636485152265052];
const Pt_VIELHR_122 = [51.58642450156037, 4.49425755553108];
const Pt_VIELHR_123 = [51.60086559940332, 4.350500630706672];
const Pt_VIELHR_124 = [51.614732331207755, 4.2064378405327645];
const Pt_VIELHR_125 = [51.6282150897088, 4.063598513517215];
const Pt_VIELHR_126 = [51.64188365545717, 3.921065050653376];//ã‚ªãƒ©ãƒ³ãƒ€å´é™¸åœ°
const Pt_VIELHR_127 = [51.65505676059435, 3.777198666313686];
const Pt_VIELHR_128 = [51.669096423910105, 3.6321370486300713];
const Pt_VIELHR_129 = [51.68408853205074, 3.4927338616472814];
const Pt_VIELHR_130 = [51.69716270135797, 3.3456146304828622];
const Pt_VIELHR_131 = [51.71023309458346, 3.20415382892049];
const Pt_VIELHR_132 = [51.72648611890958, 3.0606354197985066];
const Pt_VIELHR_133 = [51.73922950182926, 2.918145815427935];
const Pt_VIELHR_134 = [51.752287740451855, 2.7725697949107913];
const Pt_VIELHR_135 = [51.75992983619097, 2.6295657856820878];
const Pt_VIELHR_136 = [51.76279528859477, 2.487590586780077];
const Pt_VIELHR_137 = [51.755472103889886, 2.345615384195125];
const Pt_VIELHR_138 = [51.74942162047407, 2.2005537633779584];
const Pt_VIELHR_139 = [51.73827387226555, 2.053948935515069];
const Pt_VIELHR_140 = [51.72489294333361, 1.912488137208336];
const Pt_VIELHR_141 = [51.713739142746974, 1.7699985326241114];
const Pt_VIELHR_142 = [51.70066976245587, 1.6239081071572739];
const Pt_VIELHR_143 = [51.68950998675781, 1.482447307660198];
const Pt_VIELHR_144 = [51.67675258810262, 1.3368712856780167];
const Pt_VIELHR_145 = [51.665905972451704, 1.1923240692204606];
const Pt_VIELHR_146 = [51.653461068319366, 1.048805661634733];
const Pt_VIELHR_147 = [51.64228965447761, 0.906316056114513];//ã‚¤ã‚®ãƒªã‚¹å´é™¸åœ°
const Pt_VIELHR_148 = [51.63750106303092, 0.7602256310241087];
const Pt_VIELHR_149 = [51.639416560283685, 0.6177360278540531];
const Pt_VIELHR_150 = [51.646439358202215, 0.47164560206165196];
const Pt_VIELHR_151 = [51.649312007449566, 0.3276127866673716];
const Pt_VIELHR_152 = [51.6540993517355, 0.2123865364111387];
const Pt_VIELHR_153 = [51.65824797455883, 0.1259668497872207];
const Pt_VIELHR_154 = [51.65920529509907, 0.05189283296878048];//ç€é™¸å‰æ—‹å›žé–‹å§‹
const Pt_VIELHR_155 = [51.652990478652924, 0.01141803104631799];
const Pt_VIELHR_156 = [51.627779390497736, -0.012670598680202686];//Chingford
const Pt_VIELHR_157 = [51.59854587390946, -0.0033955282216072123];
const Pt_VIELHR_158 = [51.57848527155859, 0.04030232406961492];
const Pt_VIELHR_159 = [51.55524613884885, 0.05875252810883534]; //Ilford
const Pt_VIELHR_160 = [51.515531059644424, 0.051712318648809825];
const Pt_VIELHR_161 = [51.49936329625239, 0.024522544275221818];
const Pt_VIELHR_162 = [51.48530628069054, -0.009221907849141849];
const Pt_VIELHR_163 = [51.478956529594335, -0.06044550286530193];
const Pt_VIELHR_164 = [51.47502528857829, -0.09491825305528959];//Canberwell
const Pt_VIELHR_165 = [51.46951856377472, -0.13933513928467584];//1305
const Pt_VIELHR_166 = [51.46709887799566, -0.1823046945377795];
const Pt_VIELHR_167 = [51.46682733317303, -0.2392717072058522];
const Pt_VIELHR_168 = [51.46631863749705, -0.2968394502367601];//Richmond
const Pt_VIELHR_169 = [51.465382545913045, -0.355368761840593];//Hounslow
const Pt_VIELHR_170 = [51.46524871673293, -0.3989786188197647];
const Pt_VIELHR_171 = [51.46502389582478, -0.4202701609430417];
const Pt_VIELHR_172 = [51.465017007564015, -0.4277375524443472];//HattonCross
const Pt_VIELHR_173 = [51.46494138687028, -0.4356274424993907];//ç€é™¸
const Pt_VIELHR_174 = [51.46500118540232, -0.4492775166237857];
const Pt_VIELHR_175 = [51.46500118540232, -0.4522513981958969];
const Pt_VIELHR_176 = [51.4649633750582, -0.4542845621626607];
const Pt_VIELHR_177 = [51.46498228023454, -0.4558625401396994];
const Pt_VIELHR_178 = [51.464925564682, -0.45689429497084];//é›¢é™¸ãƒ»ç€é™¸åœ°ç‚¹
const Pt_VIELHR_179 = [51.465625051570335, -0.45838123575689554];
const Pt_VIELHR_180 = [51.466589191597635, -0.45923091620607015];//1555
const Pt_VIELHR_181 = [51.46670261849684, -0.4577743211503423];
const Pt_VIELHR_182 = [51.46662700059537, -0.45546804564543975];
const Pt_VIELHR_183 = [51.46747769476174, -0.4557715029487164];
const Pt_VIELHR_184 = [51.46751550302324, -0.4557715029487164];
const Pt_VIELHR_185 = [51.468158238675585, -0.4559232316003547];
const Heathrow_VIE = [51.46859302530647, -0.4562873803642867];


const VIEtoLHR = L.polyline([
Vienna_LHR,
Pt_VIELHR_1,Pt_VIELHR_2,Pt_VIELHR_3,Pt_VIELHR_4,Pt_VIELHR_5,Pt_VIELHR_6,Pt_VIELHR_7,Pt_VIELHR_8,Pt_VIELHR_9,Pt_VIELHR_10,
Pt_VIELHR_11,Pt_VIELHR_12,Pt_VIELHR_13,Pt_VIELHR_14,Pt_VIELHR_15,Pt_VIELHR_16,Pt_VIELHR_17,Pt_VIELHR_18,Pt_VIELHR_19,Pt_VIELHR_20,
Pt_VIELHR_21,Pt_VIELHR_22,Pt_VIELHR_23,Pt_VIELHR_24,Pt_VIELHR_25,Pt_VIELHR_26,Pt_VIELHR_27,Pt_VIELHR_28,Pt_VIELHR_29,Pt_VIELHR_30,
Pt_VIELHR_31,Pt_VIELHR_32,Pt_VIELHR_33,Pt_VIELHR_34,Pt_VIELHR_35,Pt_VIELHR_36,Pt_VIELHR_37,Pt_VIELHR_38,Pt_VIELHR_39,Pt_VIELHR_40,
Pt_VIELHR_41,Pt_VIELHR_42,Pt_VIELHR_43,Pt_VIELHR_44,Pt_VIELHR_45,Pt_VIELHR_46,Pt_VIELHR_47,Pt_VIELHR_48,Pt_VIELHR_49,Pt_VIELHR_50,
Pt_VIELHR_51,Pt_VIELHR_52,Pt_VIELHR_53,Pt_VIELHR_54,Pt_VIELHR_55,Pt_VIELHR_56,Pt_VIELHR_57,Pt_VIELHR_58,Pt_VIELHR_59,Pt_VIELHR_60,
Pt_VIELHR_61,Pt_VIELHR_62,Pt_VIELHR_63,Pt_VIELHR_64,Pt_VIELHR_65,Pt_VIELHR_66,Pt_VIELHR_67,Pt_VIELHR_68,Pt_VIELHR_69,Pt_VIELHR_70,
Pt_VIELHR_71,Pt_VIELHR_72,Pt_VIELHR_73,Pt_VIELHR_74,Pt_VIELHR_75,Pt_VIELHR_76,Pt_VIELHR_77,Pt_VIELHR_78,Pt_VIELHR_79,Pt_VIELHR_80,
Pt_VIELHR_81,Pt_VIELHR_82,Pt_VIELHR_83,Pt_VIELHR_84,Pt_VIELHR_85,Pt_VIELHR_86,Pt_VIELHR_87,Pt_VIELHR_88,Pt_VIELHR_89,Pt_VIELHR_90,
Pt_VIELHR_91,Pt_VIELHR_92,Pt_VIELHR_93,Pt_VIELHR_94,Pt_VIELHR_95,Pt_VIELHR_96,Pt_VIELHR_97,Pt_VIELHR_98,Pt_VIELHR_99,Pt_VIELHR_100,
Pt_VIELHR_101,Pt_VIELHR_102,Pt_VIELHR_103,Pt_VIELHR_104,Pt_VIELHR_105,Pt_VIELHR_106,Pt_VIELHR_107,Pt_VIELHR_108,Pt_VIELHR_109,Pt_VIELHR_110,
Pt_VIELHR_111,Pt_VIELHR_112,Pt_VIELHR_113,Pt_VIELHR_114,Pt_VIELHR_115,Pt_VIELHR_116,Pt_VIELHR_117,Pt_VIELHR_118,Pt_VIELHR_119,Pt_VIELHR_120,
Pt_VIELHR_121,Pt_VIELHR_122,Pt_VIELHR_123,Pt_VIELHR_124,Pt_VIELHR_125,Pt_VIELHR_126,Pt_VIELHR_127,Pt_VIELHR_128,Pt_VIELHR_129,Pt_VIELHR_130,
Pt_VIELHR_131,Pt_VIELHR_132,Pt_VIELHR_133,Pt_VIELHR_134,Pt_VIELHR_135,Pt_VIELHR_136,Pt_VIELHR_137,Pt_VIELHR_138,Pt_VIELHR_139,Pt_VIELHR_140,
Pt_VIELHR_141,Pt_VIELHR_142,Pt_VIELHR_143,Pt_VIELHR_144,Pt_VIELHR_145,Pt_VIELHR_146,Pt_VIELHR_147,Pt_VIELHR_148,Pt_VIELHR_149,Pt_VIELHR_150,
Pt_VIELHR_151,Pt_VIELHR_152,Pt_VIELHR_153,Pt_VIELHR_154,Pt_VIELHR_155,Pt_VIELHR_156,Pt_VIELHR_157,Pt_VIELHR_158,Pt_VIELHR_159,Pt_VIELHR_160,
Pt_VIELHR_161,Pt_VIELHR_162,Pt_VIELHR_163,Pt_VIELHR_164,Pt_VIELHR_165,Pt_VIELHR_166,Pt_VIELHR_167,Pt_VIELHR_168,Pt_VIELHR_169,Pt_VIELHR_170,
Pt_VIELHR_171,Pt_VIELHR_172,Pt_VIELHR_173,Pt_VIELHR_174,Pt_VIELHR_175,Pt_VIELHR_176,Pt_VIELHR_177,Pt_VIELHR_178,Pt_VIELHR_179,Pt_VIELHR_180,
Pt_VIELHR_181,Pt_VIELHR_182,Pt_VIELHR_183,Pt_VIELHR_184,Pt_VIELHR_185,
Heathrow_VIE], { color: '#be742aff' }).addTo(map); 


// Vienna â†’ Heathrow ã¸æ»‘ã‚‰ã‹ã«ç§»å‹•ã™ã‚‹é–¢æ•°
//ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã‚’ç„¡åˆ¶é™åˆ¶é™
map.on('popupopen', function (e) {
  const HeathrowBtn = document.getElementById('ViennaToHeathrowCard');
  if (HeathrowBtn) {
    const newBtn = HeathrowBtn.cloneNode(true);
    HeathrowBtn.parentNode.replaceChild(newBtn, HeathrowBtn);

    newBtn.addEventListener('click', () => {
      if (!animationRunning) {
        goToHeathrow();
      }
    });
  }
  })

function goToHeathrow() {
  if (animationRunning) return; // â† ã™ã§ã«å‹•ã„ã¦ã„ãŸã‚‰ä½•ã‚‚ã—ãªã„
  animationRunning = true;

  markerViennaAirport.closePopup(); // â† ç§»å‹•å‰ã«Viennaï¼ˆå§‹ç™ºï¼‰ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹

  // ðŸš„ ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒžãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºï¼ˆåˆæœŸä½ç½®ï¼‰
  const trainIcon = L.icon({
    iconUrl: "../../assets/image/icon/airplane.png",// ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã®URL
    iconRetinaUrl:"../../assets/image/icon/airplane@2x.png",
    iconSize: [40, 40],
    iconAnchor: [25, 25],
    className: "icon-train"
  });

  const trainMarker = L.marker(Vienna_LHR, { icon: trainIcon }).addTo(map);

  const fullPath = interpolatePolyline(VIEtoLHR , 100);// â† æ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—

  const HeathrowIndex = fullPath.findIndex(p => 
    Math.abs(p[0] - Heathrow_VIE[0]) < 0.0001 && 
    Math.abs(p[1] - Heathrow_VIE[1]) < 0.0001
  );

  const pathToHeathrow = fullPath.slice(0, HeathrowIndex + 1);
  // âœ… ã“ã“ã« animatePath ã‚’å®šç¾©
  const totalFrames = pathToHeathrow.length;
  let frame = 0;

  function animate() {
   
   const index = frame;

    if (index < pathToHeathrow.length) {
      trainMarker.setLatLng(pathToHeathrow[index]); // â† ãƒžãƒ¼ã‚«ãƒ¼ã‚’ç§»å‹•
      map.panTo(pathToHeathrow[index], { animate: true, duration: 0.03 });
      frame++;
      setTimeout(animate, 15); // â† é€Ÿåº¦èª¿æ•´ï¼ˆæ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼‰50åº§æ¨™ Ã— 30ms = ç´„1.5ç§’
    } else {
      setTimeout(() => {
        markerHeathrowTerminal5.openPopup();
        map.removeLayer(trainMarker); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‰Šé™¤
        animationRunning = false;
      }, 300);

    }
  }
  animate();
}

// Heathrowã€€â†’ã€€Viennaã¸æ»‘ã‚‰ã‹ã«æˆ»ã‚‹é–¢æ•°
//ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã‚’ç„¡åˆ¶é™åˆ¶é™
map.on('popupopen', function (e) {
  const HeathrowToViennaBtn = document.getElementById('HeathrowToViennaCard');
  if (HeathrowToViennaBtn) {
    const newBtn = HeathrowToViennaBtn.cloneNode(true);
    HeathrowToViennaBtn.parentNode.replaceChild(newBtn, HeathrowToViennaBtn);

    newBtn.addEventListener('click', () => {
      if (!animationRunning) {
        HeathrowToVienna();
      }
    });
  }
  })

function HeathrowToVienna() {
  if (animationRunning) return; // â† ã™ã§ã«å‹•ã„ã¦ã„ãŸã‚‰ä½•ã‚‚ã—ãªã„
  animationRunning = true;

  markerHeathrowTerminal3.closePopup(); // â† ç§»å‹•å‰ã«Heathrowã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹

  // ðŸš„ ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒžãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºï¼ˆåˆæœŸä½ç½®ï¼‰
  const trainIcon = L.icon({
    iconUrl: "../../assets/image/icon/airplane.png",// ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã®URL
    iconRetinaUrl:"../../assets/image/icon/airplane@2x.png",
    iconSize: [40, 40],
    iconAnchor: [25, 25],
    className: "icon-airplane"
  });

  const trainMarker = L.marker(Heathrow_VIE, { icon: trainIcon }).addTo(map);

  const fullPath = [...interpolatePolyline(VIEtoLHR, 100)].reverse();// â† æ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—

  const HeathrowToViennaIndex = fullPath.findIndex(p => 
    Math.abs(p[0] - Vienna_LHR[0]) < 0.0001 && 
    Math.abs(p[1] - Vienna_LHR[1]) < 0.0001
  );

  const pathToHeathrowToVienna = fullPath.slice(0, HeathrowToViennaIndex + 1);
  
// æœ€åˆã«ã‚¸ãƒ£ãƒ³ãƒ—ã‚’é˜²ã
  map.panTo(pathToHeathrowToVienna[0], { animate: false });


  let frame = 0;

  function animate() {
   
   const index = frame;

    if (index < pathToHeathrowToVienna.length) {
      trainMarker.setLatLng(pathToHeathrowToVienna[index]); // â† ãƒžãƒ¼ã‚«ãƒ¼ã‚’ç§»å‹•
      map.panTo(pathToHeathrowToVienna[index], { animate: true, duration: 0.25 });
      frame++;
      setTimeout(animate, 15); // â† é€Ÿåº¦èª¿æ•´ï¼ˆæ•°å­—ãŒå°‘ãªã„ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼‰
    } else {
      setTimeout(() => {
        markerViennaAirport.openPopup();
        map.removeLayer(trainMarker); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‰Šé™¤
        animationRunning = false;
      }, 100);

    }
  }
  animate();
}



